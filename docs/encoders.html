


<!DOCTYPE html>
<!-- source: https://github.com/pages-themes/minimal/blob/master/_layouts/default.html -->
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Encoders | ODrive</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Encoders" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="High performance motor control" />
<meta property="og:description" content="High performance motor control" />
<meta property="og:site_name" content="ODrive" />
<script type="application/ld+json">
{"headline":"Encoders","description":"High performance motor control","url":"/encoders.html","@type":"WebPage","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=b4e5469dcf6e2f2139cd0ae9f20e8bf6bbb256c2">
    <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div style="position: absolute;top: 0;left: 0;width: 100%;background-color: #5bc0de;height: 20px;text-align: center;font-weight: 600">The docs reflect firmware version 0.5.1. There are many breaking <a href="/migration">changes</a>. Please find docs for v0.4.12 <a href="https://github.com/madcowswe/ODrive/blob/fw-v0.4.12/docs/getting-started.md">here</a>.</div>
    <div class="wrapper">
      <header>
        <div>
          <h1><a href="/">ODrive Documentation</a></h1>

          

          <p>High performance motor control</p>
        </div>
        <div style="overflow-y: auto;">
          <ul id="navbar">
            
            <li class="navgroup">
              <p class="navheader">General</p>
              <ul>
                
                
                
                
                
                <li><a class="navitem" href="/" alt="Getting Started">Getting Started</a></li>
                
                
                
                
                <li><a class="navitem" href="/odrivetool" alt="ODrive Tool">ODrive Tool</a></li>
                
                
                
                
                <li><a class="navitem" href="/commands" alt="Parameters & Commands">Parameters & Commands</a></li>
                
                
                
                
                <li><a class="navitem currentitem" href="/encoders" alt="Encoders">Encoders</a></li>
                
                
                
                
                <li><a class="navitem" href="/control" alt="Control & Tuning">Control & Tuning</a></li>
                
                
                
                
                <li><a class="navitem" href="/troubleshooting" alt="Troubleshooting">Troubleshooting</a></li>
                
                
                
                
                <li><a class="navitem" href="/specifications" alt="Specifications">Specifications</a></li>
                
                
              </ul>
            </li>
            
            <li class="navgroup">
              <p class="navheader">Tutorials</p>
              <ul>
                
                
                
                
                
                <li><a class="navitem" href="/hoverboard" alt="Hoverboard Guide">Hoverboard Guide</a></li>
                
                
                
                
                <li><a class="navitem" href="/migration" alt="Migration Guide">Migration Guide</a></li>
                
                
              </ul>
            </li>
            
            <li class="navgroup">
              <p class="navheader">Interfaces</p>
              <ul>
                
                
                
                
                
                <li><a class="navitem" href="/pinout" alt="Pinout">Pinout</a></li>
                
                
                
                
                <li><a class="navitem" href="/native-protocol" alt="Native Protocol">Native Protocol</a></li>
                
                
                
                
                <li><a class="navitem" href="/can-protocol" alt="CAN Protocol">CAN Protocol</a></li>
                
                
                
                
                <li><a class="navitem" href="/ascii-protocol" alt="ASCII Protocol">ASCII Protocol</a></li>
                
                
                
                
                <li><a class="navitem" href="/step-direction" alt="Step & Direction">Step & Direction</a></li>
                
                
                
                
                <li><a class="navitem" href="/rc-pwm" alt="RC PWM">RC PWM</a></li>
                
                
                
                
                <li><a class="navitem" href="/endstops" alt="Homing & Endstops">Homing & Endstops</a></li>
                
                
                
                
                <li><a class="navitem" href="/thermistors" alt="Thermistors">Thermistors</a></li>
                
                
              </ul>
            </li>
            
            <li class="navgroup">
              <p class="navheader">API Reference</p>
              <ul>
                
                


<li>

  <input id="chk-ODrive" type="checkbox"  hidden />
  <p class="navitem">
    
    <label style="margin-left: 0px;" for="chk-ODrive" class="chevron"></label>
    <a href="/api/odrive">ODrive</a>
  </p>
  <ul class="expandable-list">

    <li>
    
      <input id="chk-ODrive.Can" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Can" class="chevron"></label>
        <a href="/api/odrive.can">Can</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.can.config">Config</a>
          </p>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.can.error">Error</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.can.protocol">Protocol</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
        <a href="/api/odrive.endpoint">Endpoint</a>
      </p>
    </li>
    <li>
    
      <input id="chk-ODrive.Axis" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Axis" class="chevron"></label>
        <a href="/api/odrive.axis">Axis</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.axis.lockinconfig">LockinConfig</a>
          </p>
        </li>
        <li>
        
          <input id="chk-ODrive.Axis.Config" type="checkbox"  hidden />
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <label style="margin-left: 0px;" for="chk-ODrive.Axis.Config" class="chevron"></label>
            <a href="/api/odrive.axis.config">Config</a>
          </p>
          <ul class="expandable-list">

            <li>
              <p class="navitem">
                <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
                <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
                <a href="/api/odrive.axis.config.calibrationlockin">CalibrationLockin</a>
              </p>
            </li>

          </ul>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.axis.error">Error</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.axis.lockinstate">LockinState</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.axis.axisstate">AxisState</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
        <a href="/api/odrive.thermistorcurrentlimiter">ThermistorCurrentLimiter</a>
      </p>
    </li>
    <li>
    
      <input id="chk-ODrive.OnboardThermistorCurrentLimiter" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.OnboardThermistorCurrentLimiter" class="chevron"></label>
        <a href="/api/odrive.onboardthermistorcurrentlimiter">OnboardThermistorCurrentLimiter</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.onboardthermistorcurrentlimiter.config">Config</a>
          </p>
        </li>

      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.OffboardThermistorCurrentLimiter" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.OffboardThermistorCurrentLimiter" class="chevron"></label>
        <a href="/api/odrive.offboardthermistorcurrentlimiter">OffboardThermistorCurrentLimiter</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.offboardthermistorcurrentlimiter.config">Config</a>
          </p>
        </li>

      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.Motor" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Motor" class="chevron"></label>
        <a href="/api/odrive.motor">Motor</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.currentcontrol">CurrentControl</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.gatedriver">GateDriver</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.timinglog">TimingLog</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.config">Config</a>
          </p>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.error">Error</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.armedstate">ArmedState</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.motor.motortype">MotorType</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.Controller" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Controller" class="chevron"></label>
        <a href="/api/odrive.controller">Controller</a>
      </p>
      <ul class="expandable-list">

        <li>
        
          <input id="chk-ODrive.Controller.Config" type="checkbox"  hidden />
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <label style="margin-left: 0px;" for="chk-ODrive.Controller.Config" class="chevron"></label>
            <a href="/api/odrive.controller.config">Config</a>
          </p>
          <ul class="expandable-list">

            <li>
              <p class="navitem">
                <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
                <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
                <a href="/api/odrive.controller.config.anticogging">Anticogging</a>
              </p>
            </li>

          </ul>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.controller.error">Error</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.controller.controlmode">ControlMode</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.controller.inputmode">InputMode</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.Encoder" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Encoder" class="chevron"></label>
        <a href="/api/odrive.encoder">Encoder</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.encoder.config">Config</a>
          </p>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.encoder.error">Error</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.encoder.mode">Mode</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.SensorlessEstimator" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.SensorlessEstimator" class="chevron"></label>
        <a href="/api/odrive.sensorlessestimator">SensorlessEstimator</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.sensorlessestimator.config">Config</a>
          </p>
        </li>

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.sensorlessestimator.error">Error</a>
          </p>
        </li>
      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.TrapezoidalTrajectory" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.TrapezoidalTrajectory" class="chevron"></label>
        <a href="/api/odrive.trapezoidaltrajectory">TrapezoidalTrajectory</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.trapezoidaltrajectory.config">Config</a>
          </p>
        </li>

      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.Endstop" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.Endstop" class="chevron"></label>
        <a href="/api/odrive.endstop">Endstop</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.endstop.config">Config</a>
          </p>
        </li>

      </ul>
    </li>
    <li>
    
      <input id="chk-ODrive.SystemStats" type="checkbox"  hidden />
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <label style="margin-left: 0px;" for="chk-ODrive.SystemStats" class="chevron"></label>
        <a href="/api/odrive.systemstats">SystemStats</a>
      </p>
      <ul class="expandable-list">

        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.systemstats.usb">Usb</a>
          </p>
        </li>
        <li>
          <p class="navitem">
            <a class="levelbar">&nbsp;</a><a class="levelbar">&nbsp;</a>
            <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
            <a href="/api/odrive.systemstats.i2c">I2C</a>
          </p>
        </li>

      </ul>
    </li>
    <li>
      <p class="navitem">
        <a class="levelbar">&nbsp;</a>
        <span style="margin-left: 7px; margin-right: 10px; float: inline-start;">&bull;</span>
        <a href="/api/odrive.config">Config</a>
      </p>
    </li>

  </ul>
</li>
                
              </ul>
            </li>
            
            <li class="navgroup">
              <p class="navheader">For ODrive Developers</p>
              <ul>
                
                
                
                
                
                <li><a class="navitem" href="/developer-guide" alt="Firmware Developer Guide">Firmware Developer Guide</a></li>
                
                
                
                
                <li><a class="navitem" href="/configuring-vscode" alt="Configuring Visual Studio Code">Configuring Visual Studio Code</a></li>
                
                
                
                
                <li><a class="navitem" href="/configuring-eclipse" alt="Configuring Eclipse">Configuring Eclipse</a></li>
                
                
              </ul>
            </li>
            
            <li class="navgroup">
              <p class="navheader">Component Guides</p>
              <ul>
                
                
                
                
                
                <li><a class="navitem" href="https://docs.google.com/spreadsheets/d/12vzz7XVEK6YNIOqH0jAz51F5VUpc-lJEs3mmkWP1H4Y" alt="Motor Guide">Motor Guide</a></li>
                
                
                
                
                <li><a class="navitem" href="https://docs.google.com/spreadsheets/d/1OBDwYrBb5zUPZLrhL98ezZbg94tUsZcdTuwiVNgVqpU" alt="Encoder Guide">Encoder Guide</a></li>
                
                
              </ul>
            </li>
            
          </ul>
        </div>
        <div style="margin-top: 10px;">
          
          <p class="view"><a href="https://github.com/madcowswe/ODrive">View the Project on GitHub <small>madcowswe/ODrive</small></a></p>
          

          
          
          <p>Help improve these docs: submit edits using the link in the top right.</p>
          <p>If you need help, please search or ask the <a href=https://discourse.odriverobotics.com>ODrive Community</a>.</p>

          
        </div>
      </header>
      <section>

        <div class="pageactions">
          <div>
            <!-- edit icon taken from GitHub -->
            <svg transform="translate(0,1)" class="octicon octicon-pencil" viewBox="0 0 14 16" version="1.1" width="10" height="12" aria-hidden="true">
              <path fill-rule="evenodd" d="M0 12v3h3l8-8-3-3-8 8zm3 2H1v-2h1v1h1v1zm10.3-9.3L12 6 9 3l1.3-1.3a.996.996 0 0 1 1.41 0l1.59 1.59c.39.39.39 1.02 0 1.41z"></path>
            </svg>
            
            <a href="https://www.github.com/madcowswe/ODrive/edit/master/docs/encoders.md">edit on GitHub</a>
          </div>

          
        </div>


      <h1 id="encoders">Encoders</h1>

<h2 id="known-and-supported-encoders">Known and Supported Encoders</h2>
<p>Be sure to read the <a href="https://docs.google.com/spreadsheets/d/1OBDwYrBb5zUPZLrhL98ezZbg94tUsZcdTuwiVNgVqpU">ODrive Encoder Guide</a>.</p>

<h2 id="encoder-calibration">Encoder Calibration</h2>
<p>All encoder types supported by ODrive require that you do some sort of encoder calibration. This requires the following:</p>
<ul>
  <li>Selecting an encoder and mounting it to your motor</li>
  <li>Choosing an interface (e.g., AB, ABI or SPI)</li>
  <li>Connecting the pins to the odrive</li>
  <li>Loading the correct odrive firmware (the default will work in many cases)</li>
  <li>Motor calibration</li>
  <li>Saving the settings in the odrive for correct bootup</li>
</ul>

<h3 id="encoder-without-index-signal">Encoder without index signal</h3>
<p>During encoder offset calibration the rotor must be allowed to rotate without any biased load during startup. That means mass and weak friction loads are fine, but gravity or spring loads are not okay.</p>

<p>In the <code class="language-plaintext highlighter-rouge">odrivetool</code>, type <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_ENCODER_OFFSET_CALIBRATION</code> <kbd>Enter</kbd>.</p>

<p>To verify everything went well, check the following variables:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.error</code> should be 0.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.offset</code> - This should print a number, like -326 or 1364.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.direction</code> - This should print 1 or -1.</li>
</ul>

<h3 id="encoder-with-index-signal">Encoder with index signal</h3>
<p>If you have an encoder with an index (Z) signal, you can avoid doing the offset calibration on every startup, and instead use the index signal to re-sync the encoder to a stored calibration.</p>

<p>Below are the steps to do the one-time calibration and configuration. Note that you can follow these steps with one motor at a time, or all motors together, as you wish.</p>

<ul>
  <li>Since you will only do this once, it is recommended that you mechanically disengage the motor from anything other than the encoder, so that it can spin freely.</li>
  <li>Set <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.use_index</code> to <code class="language-plaintext highlighter-rouge">True</code>.</li>
  <li>Run <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_ENCODER_INDEX_SEARCH</code>. This will make the motor turn in one direction until it finds the encoder index.</li>
  <li>Follow the calibration instructions for an <a href="#encoder-without-index-signal">encoder without index signal</a>.</li>
  <li>Set <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.pre_calibrated</code> to <code class="language-plaintext highlighter-rouge">True</code> to confirm that the offset is valid with respect to the index pulse.</li>
  <li>If you would like to search for the index at startup, set <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.config.startup_encoder_index_search</code> to <code class="language-plaintext highlighter-rouge">True</code>.
    <ul>
      <li>If you’d rather do it manually, just run <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_ENCODER_INDEX_SEARCH</code> on every bootup.</li>
    </ul>
  </li>
  <li>If you are looking to start your machine as quickly as possible on bootup, also set <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.pre_calibrated</code> to <code class="language-plaintext highlighter-rouge">True</code> to save the current motor calibration and avoid doing it again on bootup.</li>
  <li>Save the configuration by typing <code class="language-plaintext highlighter-rouge">&lt;odrv&gt;.save_configuration()</code> <kbd>Enter</kbd>.</li>
</ul>

<p>That’s it, now on every reboot the motor will turn in one direction until it finds the encoder index.</p>

<ul>
  <li>If your motor has problems reaching the index location due to the mechanical load, you can increase <code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.calibration_current</code>.</li>
</ul>

<h3 id="reversing-index-search">Reversing index search</h3>
<p>Sometimes you would like the index search to only happen in a particular direction (the reverse of the default). Instead of swapping the motor leads, you can ensure that the following three values are negative:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis0&gt;.config.calibration_lockin.vel</code></li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis0&gt;.config.calibration_lockin.accel</code></li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis0&gt;.config.calibration_lockin.ramp_distance</code></li>
</ul>

<p><em>IMPORTANT:</em> Your motor should find the same rotational position when the ODrive performs an index search if the index signal is working properly. This means that the motor should spin, and stop at the same position if you have set <axis>.config.startup_encoder_index_search so the search starts on reboot, or you if call the command:<axis>.requested_state = AXIS_STATE_ENCODER_INDEX_SEARCH after reboot. You can test this. Send the reboot() command, and while it's rebooting turn your motor, then make sure the motor returns back to the correct position each time when it comes out of reboot. Try this procedure a couple of times to be sure.</axis></axis></p>

<h3 id="hall-effect-encoders">Hall Effect Encoders</h3>
<p>Hall effect encoders can also be used with ODrive. The encoder CPR should be set to <code class="language-plaintext highlighter-rouge">6 * &lt;# of motor pole pairs&gt;</code>. Due to the low resolution of hall effect encoders compared to other types of encoders, low speed performance will be worse than other encoder types.</p>

<p>When the encoder mode is set to hall feedback, the pinout on the encoder port is as follows:</p>

<table>
  <thead>
    <tr>
      <th>Label on ODrive</th>
      <th>Hall feedback</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>A</td>
      <td>Hall A</td>
    </tr>
    <tr>
      <td>B</td>
      <td>Hall B</td>
    </tr>
    <tr>
      <td>Z</td>
      <td>Hall C</td>
    </tr>
  </tbody>
</table>

<h3 id="startup-sequence-notes">Startup sequence notes</h3>
<p>The following are variables that MUST be set up for your encoder configuration. Your values will vary depending on your encoder:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.cpr = 8192</code></li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.mode = ENCODER_MODE_INCREMENTAL</code></li>
</ul>

<p>The following are examples of values that can impact the success of calibration. These are not all of the variables you have to set for startup. Only change these when you understand why they are needed; your values will vary depending on your setup:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.motor_type = MOTOR_TYPE_HIGH_CURRENT</code> The type of motor you have. Valid choices are high current or gimbal.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.calib_range = 0.05</code> Helps to relax the accuracy of encoder counts during calibration</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.calibration_current = 10.0</code> The motor current used for calibration. For large motors, this value can be increased to overcome friction and cogging.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.resistance_calib_max_voltage = 12.0</code> Max motor voltage used for measuring motor resistance. For motor calibration, it must be possible for the motor current to reach the calibration current without the applied voltage exceeding this config setting.</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.controller.config.vel_limit = 5</code> [turn/s] low values result in the spinning motor stopping abruptly during calibration</li>
</ul>

<p>Lots of other values can get you. It’s a process. Thankfully there are a lot of good people that will help you debug calibration problems.</p>

<p>If calibration works, congratulations.</p>

<p>Now try:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL</code></li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.controller.input_vel = 1.5</code>
let it loop a few times and then set:</li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_IDLE</code></li>
</ul>

<p>Do you still have no errors? Awesome. Now, setup the motor and encoder to use known calibration values. This allows you to skip motor calibration and encoder offset calibration before using closed loop control. Note that this only works if you are using an absolute encoder or the encoder index input (see “Encoder with index signal” above).</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.pre_calibrated = True</code></li>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.motor.config.pre_calibrated  = True </code></li>
</ul>

<p>And see if ODrive agrees that the calibration worked by just running</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.pre_calibrated</code></li>
</ul>

<p>(using no “= True” ). Make sure that ‘pre_calibrated’ is in fact True.</p>

<p>Also, if you have calibrated and encoder.pre_calibrated is equal to true, and you had no errors so far, run this:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">odrv0.save_configuration()</code></li>
  <li><code class="language-plaintext highlighter-rouge">odrv0.reboot()</code></li>
</ul>

<p>and now see if after a reboot you can run:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_ENCODER_INDEX_SEARCH</code></li>
</ul>

<p>without getting errors.</p>

<h2 id="what-happens-if-calibration-fails">What happens if calibration fails</h2>
<p>There are subtle ways that encoder problems will impact your ODrive. For example, ODrive may not complete the calibrate sequence when you go to:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE</code></li>
</ul>

<p>Or, ODrive may complete the calibrate sequence after:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE</code></li>
</ul>

<p>but then it fails after you go to:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.requested_state = AXIS_STATE_CLOSED_LOOP_CONTROL</code></li>
</ul>

<p>Or ODrive may just vibrate in an entertaining way. See:
https://www.youtube.com/watch?v=gaRUmwvSyAs</p>

<h2 id="encoder-testing">Encoder Testing</h2>
<p>There are things you can test to make sure your encoder is properly connected. <code class="language-plaintext highlighter-rouge">shadow_count</code> tracks encoder motion, even before the encoder or motor are calibrated. If your encoder is working, you should see this value change when you turn the motor.
Run the command:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.shadow_count </code></li>
</ul>

<p>and look at your value. Then turn your motor by hand and see if that value changes. Also, notice that the command:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">&lt;axis&gt;.encoder.config.cpr = 4000</code></li>
</ul>

<p>must reflect the number of counts ODrive receives after one complete turn of the motor. So use shadow_count to test if that is working properly.</p>

<p>You will probably never be able to properly debug if you have problems unless you use an oscilloscope. If you have one, try the following:
Connect to the AB pins, see if you get square waves as you turn the motor.
Connect to the I pin, see if you get a pulse on a complete rotation. Sometimes this is hard to see.</p>

<p>If you are using SPI, use a logic analyzer and connect to the CLK, MISO, and CS pins. Set a trigger for the CS pin and ensure that the encoder position is being sent and is increasing/decreasing as you spin the motor. There is extremely cheap hardware that is supported by <a href="https://sigrok.org/">Sigrok</a> for protocol analysis.</p>

<h2 id="encoder-noise">Encoder Noise</h2>
<p>Noise is found in all circuits, life is just about figuring out if it is preventing your system from working. Lots of users have no problems with noise interfering with their ODrive operation, others will tell you “<em>I’ve been using the same encoder as you with no problems</em>”. Power to ‘em, that may be true, but it doesn’t mean it will work for you. If you are concerned about noise, there are several possible sources:</p>

<ul>
  <li>Importantly, encoder wires may be too close to motor wires, avoid overlap as much as possible</li>
  <li>Long wires between encoder and ODrive</li>
  <li>Use of ribbon cable</li>
</ul>

<p>The following <em>might</em> mitigate noise problems. Use shielded cable, or use twisted pairs, where one side of each twisted pair is tied to ground and the other side is tied to your signal. If you are using SPI, use a 20-50 ohm resistor in series on CLK, which is more susceptible noise.</p>

<p>If you are using an encoder with an index signal, another problem that has been encountered is noise on the Z input of ODrive. Symptoms for this problem include:</p>
<ul>
  <li>difficulty with requested_state = AXIS_STATE_FULL_CALIBRATION_SEQUENCE, where your calibration sequence may not complete</li>
  <li>strange behavior after performing odrv0.save_configuration() and odrv0.reboot()</li>
  <li>when performing an index_search, the motor does not return to the same position each time.
One easy step that <em>might</em> fix the noise on the Z input is to solder a 22nF-47nF capacitor to the Z pin and the GND pin on the underside of the ODrive board.</li>
</ul>

<h2 id="spi-encoders">SPI Encoders</h2>

<p>Apart from (incremental) quadrature encoders, ODrive also supports absolute SPI encoders (since firmware v0.5). These usually measure an absolute angle. This means you don’t need to repeat the encoder calibration after every ODrive reboot. Currently, the following modes are supported:</p>

<ul>
  <li><strong>CUI protocol</strong>: Compatible with the AMT23xx family (AMT232A, AMT232B, AMT233A, AMT233B).</li>
  <li><strong>AMS protocol</strong>: Compatible with AS5047P and AS5048A/AS5048B.</li>
</ul>

<p>Some of these chips come with evaluation boards that can simplify mounting the chips to your motor. For our purposes if you are using an evaluation board you should select the settings for 3.3v.</p>

<p><strong>Note:</strong> The AMT23x family has a hardware bug that causes them to not properly tristate the MISO line. To use them with ODrive, there are two workarounds. One is to sequence power to the encoder a second or two after the ODrive recieves power. This allows 1 encoder to be used without issue. Another solution is to add a tristate buffer, such as the 74AHC1G125SE, on the MISO line between the ODrive and each AMT23x encoder. Tie the enable pin on the buffer to the CS line for the respective encoder. This allows for more than one AMT23x encoder, or one AMT23x and another SPI encoder, to be used at the same time.</p>

<ol>
  <li>
    <p>Connect the encoder to the ODrive’s SPI interface:</p>

    <ul>
      <li>The encoder’s SCK, MISO (aka “DATA” on CUI encoders), GND and 3.3V should connect to the ODrive pins with the same label.</li>
      <li>The encoder’s MOSI should be tied to 3.3V (AMS encoders only. CUI encoders don’t have this pin.)</li>
      <li>The encoder’s Chip Select (aka nCS/CSn) can be connected to any of the ODrive’s GPIOs (caution: GPIOs 1 and 2 are usually used by UART).</li>
    </ul>
  </li>
</ol>

<p>If you are having calibration problems, make sure that your magnet is centered on the axis of rotation on the motor. Some users report that this has a significant impact on calibration. Also make sure that your magnet height is within range of the spec sheet.</p>

<ol>
  <li>
    <p>In <code class="language-plaintext highlighter-rouge">odrivetool</code>, run:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;axis&gt;.encoder.config.abs_spi_cs_gpio_pin = 4  # or which ever GPIO pin you choose
&lt;axis&gt;.encoder.config.mode = ENCODER_MODE_SPI_ABS_CUI   # or ENCODER_MODE_SPI_ABS_AMS
&lt;axis&gt;.encoder.config.cpr = 2**14              # or 2**12 for AMT232A and AMT233A
&lt;odrv&gt;.save_configuration()
&lt;odrv&gt;.reboot()
</code></pre></div>    </div>
  </li>
  <li>
    <p>Run the <a href="#encoder-without-index-signal">offset calibration</a> and then save the calibration with <code class="language-plaintext highlighter-rouge">&lt;odrv&gt;.save_configuration()</code>.
The next time you reboot, the encoder should be immediately ready.</p>
  </li>
</ol>

<p>Sometimes the encoder takes longer than the ODrive to start, in which case you need to clear the errors after every restart.</p>

<p>If you are having calibration problems - make sure your magnet is centered on the axis of rotation on the motor, some users report this has a significant impact on calibration. Also make sure your magnet height is within range of the spec sheet.</p>


      </section>
      <!--<footer>
        
        <p>This project is maintained by <a href="https://github.com/madcowswe">madcowswe</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>-->
    </div>
    <script src="/assets/js/scale.fix.js"></script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-93396600-3', 'auto');
      ga('send', 'pageview');
    </script>
    
    <script type="text/javascript">
      // Rewrite all links that start with "../" to point to the GitHub repo
      window.onload = function(){
        var links = document.links;
        var i = links.length;
        while (i--) {
          if (links[i].getAttribute("href").slice(0, 3) == "../") {
            links[i].href = "https://github.com/madcowswe/ODrive/blob/master/" + links[i].getAttribute("href").slice(3);
          }
          if (links[i].getAttribute("href").slice(0, 15) == "getting-started") {
            links[i].href = "/" + links[i].getAttribute("href").slice(15);
          }
        }
      }
    </script>
    <script>
      // Scroll the navbar to the position of the selected item
      var element = document.getElementsByClassName("currentitem")[0];
      element.scrollIntoView(false);
    </script>
  </body>
</html>

